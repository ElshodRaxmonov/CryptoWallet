# Testing Guide

This document provides comprehensive testing instructions for the Crypto Wallet Android app.

## Table of Contents
1. [Test Environment Setup](#test-environment-setup)
2. [Manual Testing](#manual-testing)
3. [Unit Testing](#unit-testing)
4. [UI Testing](#ui-testing)
5. [Test Scenarios](#test-scenarios)

---

## Test Environment Setup

### Prerequisites
- Android device or emulator (API 26+)
- Sepolia testnet ETH
- Valid email for OTP testing
- Internet connection

### Test Data
- **Test Email**: Use your own email address
- **Test Wallet**: Will be generated by Dynamic SDK
- **Recipient Address**: `0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb`
- **Test Amount**: 0.001 ETH

---

## Manual Testing

### 1. Login Screen Tests

#### TC-001: Valid Email OTP Flow
**Steps:**
1. Launch app
2. Enter valid email: `yourname@example.com`
3. Click "Send OTP"
4. Check email inbox
5. Enter 6-digit OTP code
6. Click "Verify"

**Expected Result:**
- âœ… OTP sent confirmation
- âœ… Email received within 2 minutes
- âœ… OTP verification succeeds
- âœ… Navigate to Wallet Details screen

#### TC-002: Invalid Email Validation
**Steps:**
1. Launch app
2. Enter invalid email: `invalid-email`
3. Click "Send OTP"

**Expected Result:**
- âœ… Error message: "Please enter a valid email"
- âœ… No OTP sent

#### TC-003: Empty Email Field
**Steps:**
1. Launch app
2. Leave email field empty
3. Click "Send OTP"

**Expected Result:**
- âœ… Error message: "Please enter your email"

#### TC-004: Invalid OTP Code
**Steps:**
1. Complete TC-001 steps 1-4
2. Enter wrong OTP: `000000`
3. Click "Verify"

**Expected Result:**
- âœ… Error message: "Invalid OTP code"
- âœ… Remain on OTP dialog

#### TC-005: OTP Dialog Cancellation
**Steps:**
1. Complete TC-001 steps 1-4
2. Click "Cancel" on OTP dialog

**Expected Result:**
- âœ… Dialog closes
- âœ… Return to login screen
- âœ… Can resend OTP

### 2. Wallet Details Screen Tests

#### TC-006: Wallet Info Display
**Steps:**
1. Complete login (TC-001)
2. Observe wallet screen

**Expected Result:**
- âœ… Wallet address displayed (42 characters, starts with 0x)
- âœ… Network shows "Sepolia"
- âœ… Chain ID shows "11155111"
- âœ… Balance displayed (may be 0.0 if no test ETH)

#### TC-007: Copy Wallet Address
**Steps:**
1. Navigate to Wallet Details
2. Click copy icon next to address
3. Paste into text editor

**Expected Result:**
- âœ… Confirmation message: "âœ“ Address copied to clipboard"
- âœ… Clipboard contains full wallet address
- âœ… Address format is valid Ethereum address

#### TC-008: Pull to Refresh
**Steps:**
1. Navigate to Wallet Details
2. Pull down from top of screen
3. Release to refresh

**Expected Result:**
- âœ… Loading indicator appears
- âœ… Balance updates
- âœ… Loading indicator disappears

#### TC-009: Logout Functionality
**Steps:**
1. Navigate to Wallet Details
2. Click logout icon (top right)
3. Confirm logout

**Expected Result:**
- âœ… Logout confirmation dialog appears
- âœ… On confirm, navigate to login screen
- âœ… Back button doesn't return to wallet

#### TC-010: Navigation to Send Transaction
**Steps:**
1. Navigate to Wallet Details
2. Click "Send Transaction" button

**Expected Result:**
- âœ… Navigate to Send Transaction screen
- âœ… Form fields are empty
- âœ… Back button available

### 3. Send Transaction Screen Tests

#### TC-011: Valid Transaction
**Steps:**
1. Navigate to Send Transaction
2. Enter recipient: `0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb`
3. Enter amount: `0.001`
4. Click "Send Transaction"
5. Wait for confirmation

**Expected Result:**
- âœ… Loading indicator appears
- âœ… Success dialog appears
- âœ… Transaction hash displayed (66 characters, starts with 0x)
- âœ… Can copy transaction hash
- âœ… Etherscan link provided

#### TC-012: Invalid Recipient Address
**Steps:**
1. Navigate to Send Transaction
2. Enter invalid address: `0xinvalid`
3. Enter amount: `0.001`
4. Click "Send Transaction"

**Expected Result:**
- âœ… Error message: "Invalid Ethereum address"
- âœ… Transaction not sent

#### TC-013: Invalid Amount
**Steps:**
1. Navigate to Send Transaction
2. Enter valid recipient address
3. Enter invalid amount: `-1`
4. Click "Send Transaction"

**Expected Result:**
- âœ… Error message: "Invalid amount"
- âœ… Or field doesn't accept negative numbers

#### TC-014: Empty Fields
**Steps:**
1. Navigate to Send Transaction
2. Leave all fields empty
3. Observe "Send Transaction" button

**Expected Result:**
- âœ… Button is disabled
- âœ… Cannot submit

#### TC-015: Insufficient Balance
**Steps:**
1. Navigate to Send Transaction
2. Enter valid recipient address
3. Enter amount greater than balance: `100`
4. Click "Send Transaction"

**Expected Result:**
- âœ… Error message about insufficient balance
- âœ… Transaction not sent

#### TC-016: Transaction Success Dialog
**Steps:**
1. Complete TC-011
2. Observe success dialog

**Expected Result:**
- âœ… Success icon displayed
- âœ… "Transaction Sent!" message
- âœ… Full transaction hash shown
- âœ… Copy hash button works
- âœ… Etherscan link provided
- âœ… "Done" button closes dialog

#### TC-017: Form Validation - Recipient
**Steps:**
1. Navigate to Send Transaction
2. Test various recipient inputs:
   - Empty
   - Too short: `0x123`
   - Wrong format: `123456789`
   - Valid: `0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb`

**Expected Result:**
- âœ… Validation prevents submission for invalid inputs
- âœ… Valid address allows submission

#### TC-018: Form Validation - Amount
**Steps:**
1. Navigate to Send Transaction
2. Test various amount inputs:
   - Empty
   - Zero: `0`
   - Negative: `-1`
   - Decimal: `0.001`
   - Large: `100.5`

**Expected Result:**
- âœ… Only accepts positive decimal numbers
- âœ… Decimal points handled correctly
- âœ… Non-numeric input rejected

#### TC-019: Back Navigation During Transaction
**Steps:**
1. Start transaction submission (TC-011 steps 1-4)
2. Click back button during loading

**Expected Result:**
- âœ… Cannot navigate back while loading
- âœ… Or shows confirmation dialog

#### TC-020: Clear Form After Success
**Steps:**
1. Complete successful transaction (TC-011)
2. Close success dialog
3. Observe form fields

**Expected Result:**
- âœ… Form fields are cleared
- âœ… Can enter new transaction
- âœ… Ready for next transaction

---

## Unit Testing

### ViewModel Tests

```kotlin
class LoginViewModelTest {
    
    @Test
    fun `valid email enables send button`() {
        // Test email validation
    }
    
    @Test
    fun `invalid email shows error`() {
        // Test error handling
    }
    
    @Test
    fun `successful OTP verification updates state`() {
        // Test state transitions
    }
}

class WalletViewModelTest {
    
    @Test
    fun `loadWallet updates state correctly`() {
        // Test loading flow
    }
    
    @Test
    fun `refresh updates balance`() {
        // Test refresh functionality
    }
}

class SendTransactionViewModelTest {
    
    @Test
    fun `valid transaction data enables submit`() {
        // Test validation
    }
    
    @Test
    fun `sendTransaction updates state on success`() {
        // Test success flow
    }
    
    @Test
    fun `sendTransaction handles errors correctly`() {
        // Test error handling
    }
}
```

### Repository Tests

```kotlin
class WalletRepositoryTest {
    
    @Test
    fun `sendOtp returns success for valid email`() {
        // Test OTP sending
    }
    
    @Test
    fun `getBalance converts Wei to ETH correctly`() {
        // Test conversion logic
    }
    
    @Test
    fun `sendTransaction creates valid transaction`() {
        // Test transaction creation
    }
}
```

---

## UI Testing

### Compose UI Tests

```kotlin
@Test
fun loginScreen_validEmail_showsOtpDialog() {
    composeTestRule.setContent {
        LoginScreen(onLoginSuccess = {})
    }
    
    // Enter email
    composeTestRule.onNodeWithText("Email Address")
        .performTextInput("test@example.com")
    
    // Click send OTP
    composeTestRule.onNodeWithText("Send OTP")
        .performClick()
    
    // Verify OTP dialog appears
    composeTestRule.onNodeWithText("Enter OTP Code")
        .assertExists()
}

@Test
fun walletScreen_copyAddress_showsConfirmation() {
    composeTestRule.setContent {
        WalletDetailsScreen(
            onSendTransaction = {},
            onLogout = {}
        )
    }
    
    // Click copy button
    composeTestRule.onNodeWithContentDescription("Copy")
        .performClick()
    
    // Verify confirmation
    composeTestRule.onNodeWithText("âœ“ Address copied to clipboard")
        .assertExists()
}
```

---

## Test Scenarios

### Critical Path Testing

**Scenario 1: First Time User**
1. Launch app (first time)
2. Login with email OTP
3. View wallet (0 balance)
4. Navigate to send screen
5. Observe insufficient balance error
6. Get test ETH from faucet
7. Refresh wallet
8. Send transaction successfully

**Scenario 2: Returning User**
1. Launch app
2. Login (previously authenticated)
3. View updated balance
4. Send multiple transactions
5. Verify all succeed
6. Logout
7. Login again

**Scenario 3: Error Recovery**
1. Login with valid email
2. Enter wrong OTP 3 times
3. Request new OTP
4. Verify successfully
5. Proceed to wallet
6. Attempt transaction with no balance
7. Handle error gracefully
8. Get test ETH
9. Retry successfully

### Edge Cases

1. **Network Loss During OTP**
   - Send OTP
   - Disable internet
   - Attempt verify
   - Re-enable internet
   - Retry

2. **App Background During Transaction**
   - Start transaction
   - Background app
   - Wait 30 seconds
   - Foreground app
   - Verify state

3. **Rapid Button Clicking**
   - Click send OTP rapidly 5 times
   - Verify only one request sent

4. **Very Large Amounts**
   - Enter: `999999999.999999`
   - Verify validation

5. **Special Characters in Email**
   - Test: `user+test@example.com`
   - Should work (valid email format)

---

## Performance Testing

### Load Tests

1. **Rapid Refresh**
   - Pull to refresh 10 times rapidly
   - Verify no crashes
   - Check memory usage

2. **Long Session**
   - Keep app open for 30 minutes
   - Perform various operations
   - Check for memory leaks

3. **Multiple Transactions**
   - Send 10 transactions consecutively
   - Verify all succeed
   - Check performance

---

## Security Testing

### Security Checklist

- [ ] No private keys in logs
- [ ] No sensitive data in error messages
- [ ] HTTPS only for network calls
- [ ] Input sanitization working
- [ ] No data in backups
- [ ] Clipboard cleared on logout
- [ ] Session expires correctly

---

## Regression Testing

Before each release, test:

1. All critical paths
2. All error scenarios
3. Navigation flows
4. State persistence
5. Network error handling
6. UI responsiveness

---

## Test Metrics

### Coverage Goals

- Unit Tests: >80%
- Integration Tests: >60%
- UI Tests: >40%
- Manual Tests: 100% critical paths

### Quality Metrics

- Zero crashes
- <2 second screen load times
- 100% test pass rate
- All critical bugs fixed

---

## Bug Reporting Template

```markdown
### Bug Report

**Title:** [Brief description]

**Priority:** Critical / High / Medium / Low

**Environment:**
- Device: [e.g., Pixel 7]
- Android Version: [e.g., 14]
- App Version: [e.g., 1.0]

**Steps to Reproduce:**
1. 
2. 
3. 

**Expected Result:**
[What should happen]

**Actual Result:**
[What actually happened]

**Screenshots:**
[If applicable]

**Logs:**
[Relevant LogCat output]
```

---

## Test Sign-Off Criteria

Before release:
- âœ… All critical tests pass
- âœ… No known critical bugs
- âœ… Performance acceptable
- âœ… Security audit complete
- âœ… Documentation updated
- âœ… Code review approved

---

**Happy Testing! ðŸ§ª**
